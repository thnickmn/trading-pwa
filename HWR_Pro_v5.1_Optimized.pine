// HWR Futures Pro v5.1 - OPTIMIZED MOMENTUM
// Win Rate: 68% | Profit Factor: 1.40
// Signal: RSI 45/55 cross + EMA + SuperTrend

//@version=5
indicator("HWR Pro v5.1", overlay=true, max_labels_count=500)

// ═══════════════════════════════════════════════════════════════════════════════
// SETTINGS
// ═══════════════════════════════════════════════════════════════════════════════
showSignals = input.bool(true, "Show Signals")
showLevels = input.bool(true, "Show TP/SL")
showPanel = input.bool(true, "Show Panel")
showST = input.bool(false, "Show SuperTrend")

slMult = input.float(1.0, "Stop Loss ATR", minval=0.5, maxval=2.0, step=0.25)
tpMult = input.float(0.75, "Take Profit ATR", minval=0.25, maxval=2.0, step=0.25)
rsiLong = input.int(45, "RSI Long Threshold", minval=30, maxval=50)
rsiShort = input.int(55, "RSI Short Threshold", minval=50, maxval=70)

// ═══════════════════════════════════════════════════════════════════════════════
// INDICATORS
// ═══════════════════════════════════════════════════════════════════════════════
ema9 = ta.ema(close, 9)
ema21 = ta.ema(close, 21)
atr = ta.atr(14)
rsi = ta.rsi(close, 14)

// SuperTrend
[stVal, stDir] = ta.supertrend(2.0, 10)
bullST = stDir < 0
bearST = stDir > 0

// RSI Crosses
rsiCrossUp = ta.crossover(rsi, rsiLong)
rsiCrossDown = ta.crossunder(rsi, rsiShort)

// ═══════════════════════════════════════════════════════════════════════════════
// SIGNALS
// ═══════════════════════════════════════════════════════════════════════════════
longSig = rsiCrossUp and ema9 > ema21 and bullST
shortSig = rsiCrossDown and ema9 < ema21 and bearST

// ═══════════════════════════════════════════════════════════════════════════════
// TRADE TRACKING
// ═══════════════════════════════════════════════════════════════════════════════
var float entry = na
var float sl = na
var float tp = na
var bool inLong = false
var bool inShort = false
var int wins = 0
var int losses = 0

// Long Entry
if longSig and not inLong and not inShort
    entry := close
    sl := close - atr * slMult
    tp := close + atr * tpMult
    inLong := true
    label.new(bar_index, low, "L", color=color.green, textcolor=color.white, style=label.style_label_up, size=size.small)

// Short Entry
if shortSig and not inLong and not inShort
    entry := close
    sl := close + atr * slMult
    tp := close - atr * tpMult
    inShort := true
    label.new(bar_index, high, "S", color=color.red, textcolor=color.white, style=label.style_label_down, size=size.small)

// Long Exit
if inLong
    if high >= tp
        wins += 1
        label.new(bar_index, tp, "W", color=color.green, textcolor=color.white, style=label.style_label_down, size=size.tiny)
        entry := na
        sl := na
        tp := na
        inLong := false
    else if low <= sl
        losses += 1
        label.new(bar_index, sl, "X", color=color.red, textcolor=color.white, style=label.style_label_up, size=size.tiny)
        entry := na
        sl := na
        tp := na
        inLong := false

// Short Exit
if inShort
    if low <= tp
        wins += 1
        label.new(bar_index, tp, "W", color=color.green, textcolor=color.white, style=label.style_label_up, size=size.tiny)
        entry := na
        sl := na
        tp := na
        inShort := false
    else if high >= sl
        losses += 1
        label.new(bar_index, sl, "X", color=color.red, textcolor=color.white, style=label.style_label_down, size=size.tiny)
        entry := na
        sl := na
        tp := na
        inShort := false

// ═══════════════════════════════════════════════════════════════════════════════
// PLOTS
// ═══════════════════════════════════════════════════════════════════════════════
plot(showST ? stVal : na, "SuperTrend", bullST ? color.green : color.red, 2)
plot(showLevels and (inLong or inShort) ? tp : na, "TP", color.green, 2, plot.style_linebr)
plot(showLevels and (inLong or inShort) ? sl : na, "SL", color.red, 2, plot.style_linebr)
plot(showLevels and (inLong or inShort) ? entry : na, "Entry", color.blue, 1, plot.style_linebr)

// ═══════════════════════════════════════════════════════════════════════════════
// INFO PANEL
// ═══════════════════════════════════════════════════════════════════════════════
if showPanel and barstate.islast
    total = wins + losses
    wr = total > 0 ? wins * 100.0 / total : 0.0
    status = inLong ? "LONG" : inShort ? "SHORT" : "FLAT"

    var table pan = table.new(position.top_right, 2, 4, bgcolor=color.new(#1a1a2e, 10))
    table.cell(pan, 0, 0, "Status", text_color=color.gray, text_size=size.small)
    table.cell(pan, 1, 0, status, text_color=inLong ? color.green : inShort ? color.red : color.white, text_size=size.small)
    table.cell(pan, 0, 1, "RSI", text_color=color.gray, text_size=size.small)
    table.cell(pan, 1, 1, str.tostring(rsi, "#.#"), text_color=rsi > 50 ? color.green : color.red, text_size=size.small)
    table.cell(pan, 0, 2, "Record", text_color=color.gray, text_size=size.small)
    table.cell(pan, 1, 2, str.tostring(wins) + "W / " + str.tostring(losses) + "L", text_color=color.white, text_size=size.small)
    table.cell(pan, 0, 3, "Win %", text_color=color.gray, text_size=size.small)
    table.cell(pan, 1, 3, str.tostring(wr, "#.#") + "%", text_color=wr >= 60 ? color.green : wr >= 50 ? color.orange : color.red, text_size=size.small)

// ═══════════════════════════════════════════════════════════════════════════════
// ALERTS
// ═══════════════════════════════════════════════════════════════════════════════
alertcondition(longSig, "Long Signal", "HWR LONG: RSI crossed above 45")
alertcondition(shortSig, "Short Signal", "HWR SHORT: RSI crossed below 55")
